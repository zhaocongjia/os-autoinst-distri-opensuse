<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/console_redirection.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../style.css' />
</head>

<body>



<ul id="index"><li><a href="../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a>
    <ul>
      <li><a href="#handle_login_prompt">handle_login_prompt</a></li>
      <li><a href="#redirection_init">redirection_init</a></li>
      <li><a href="#set_serial_term_prompt">set_serial_term_prompt</a></li>
      <li><a href="#connect_target_to_serial">connect_target_to_serial</a></li>
      <li><a href="#disconnect_target_from_serial">disconnect_target_from_serial</a></li>
      <li><a href="#check_serial_redirection">check_serial_redirection</a></li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/console_redirection.pm</h1>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Library that enables console redirection and file transfers from worker based VM to another host. Can be used for cases where worker VM is not the target host for API calls and command execution, but serves only as a jumphost.</p>

<h2 id="handle_login_prompt">handle_login_prompt</h2>

<pre><code>handle_login_prompt();</code></pre>

<p><b>ssh_user</b>: Login user</p>

<p>Detects if login prompt appears and types the password. In case of ssh keys being in place and command prompt appears, the function does not type anything.</p>

<h2 id="redirection_init">redirection_init</h2>

<pre><code>redirection_init();</code></pre>

<p>Do preparation before redirecting console. Gets base VM id and initial setup. This is required to be done only once at the beginning of the whole test. If you have a multi machine setup, execute this on each worker VM.</p>

<h2 id="set_serial_term_prompt">set_serial_term_prompt</h2>

<pre><code>set_serial_term_prompt();</code></pre>

<p>Set expected serial prompt according to user which is currently active. This changes global setting $testapi::distri-&gt;{serial_term_prompt} which is important for calls like wait_for_serial.</p>

<h2 id="connect_target_to_serial">connect_target_to_serial</h2>

<pre><code>connect_target_to_serial([ssh_user=&gt;ssh_user, target_ip=&gt;$target_ip]);</code></pre>

<p><b>ssh_user</b>: Login user - default value is defined by OpenQA parameter REDIRECT_TARGET_USER</p>

<p><b>target_ip</b>: Target host IP - default value is defined by OpenQA parameter REDIRECT_TARGET_IP</p>

<p>Establishes ssh connection to target and redirects serial output to serial concole on worker VM. This allows OpenQA access to command return codes and output for evaulation by standard API call.</p>

<h2 id="disconnect_target_from_serial">disconnect_target_from_serial</h2>

<pre><code>disconnect_target_from_serial([worker_machine_id=$worker_machine_id]);</code></pre>

<p><b>worker_machine_id</b>: Target host IP - default value is defined by OpenQA parameter WORKER_VM_ID from redirect_init()</p>

<p>Disconnects target from serial console by typing &#39;exit&#39; command until host machine ID matches ID of the worker VM.</p>

<h2 id="check_serial_redirection">check_serial_redirection</h2>

<pre><code>check_serial_redirection([worker_machine_id=$worker_machine_id]);</code></pre>

<p><b>worker_machine_id</b>: Target host IP - default value is defined by OpenQA parameter WORKER_VM_ID from redirect_init()</p>

<p>Compares current machine-id to the worker VM ID either defined by WORKER_VM_ID variable or positional argument. Machine ID is used instead of IP addr since cloud VM IP might not be visible from the inside (for example via &#39;ip a&#39;)</p>


</body>

</html>


